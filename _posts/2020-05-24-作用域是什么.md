---
layout:     post
title:      作用域是什么
subtitle:   
date:       2020-05-24
author:     Faymi
header-img: img/post-bg-js-version.jpg
catalog: true
tags:
    - Javascript
    - Javascript基础
---

## 作用域是什么

#### 编译原理

说到作用域，我们不得不说编译原理，在传统编译语言流程中，源代码在执行前都会经历三个步骤：

- 分词/词法分析（Tokenizing/Lexing）

  将由字符组成的字符串分解成对编程语言有意义的代码块，这些代码块被称为词法单元（token）。如 var a = 2; 分解成 var、a、=、2、；。

- 解析/语法分析（Parsing）

  将词法单元流（数组）转换成一个由元素逐渐嵌套所组成的代表了程序语法结构的树，这个数被称为“抽象语法树（AST）”。

- 代码生成（generate）

  将AST转换成可执行代码的过程被称为代码生成。

#### 理解作用域

**作用域**：负责收集并维护由所有声明的标识符（变量）组成的一些列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。

**作用域链**：当一个块或函数嵌套在另一个块或函数中时，就会发生作用域嵌套，即嵌套作用域链。因此，在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，知道找到该变量，或者抵达最外层的作用域（全局作用域）为止。

作用域是一套规则，用于确定在何处以及如何查找变量（标识符）。如果查找的目的是对变量进行赋值，那么就会使用LHS查询；如果目的是获取变量的值，就会使用RHS查询。赋值操作会导致LHS查询。=操作符或调用函数时传入参数的操作都会导致关联作用域的赋值操作。

JavaScript引擎首先会在代码执行前对其进行编译，在这个过程中，像 var a = 2 这样的声明会被分解成两个独立的步骤：

1. 遇到 var a，编译器会询问作用域是否已经有一个改名称的变量存在与同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则，它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为a。
2. 接下来编译器会为引擎生成运行时所需的代码，这些代码会被用来处理 a = 2 这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫做 a 的变量。如果是，引擎就会使用这个变量；否则，引擎会继续查找该变量。（LHS查询）

LHS 和 RHS 查询都会在当前执行作用域中开始，如果没有找到所需的标识符，就会向上级作用域继续查找目标标识符，这样每次上升一级作用域，最后抵达全局作用域，无论是否找到，都将停止。

不成功的 RHS 引用会导致抛出 ReferenceError 异常。不成功的 LHS 引用会导致自动隐式的创建一个全局变量（非严格模式下），该变量使用 LHS 引用的目标作为标识符，或抛出 ReferenceError（严格模式下）。